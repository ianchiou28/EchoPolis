<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echopolis 事件触发演示</title>
    <style>
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; padding: 20px; background: #1e3c72; color: white; }
        .demo-section { margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #357abd; }
        .result { margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 4px; }
    </style>
</head>
<body>
    <h1>🌆 Echopolis 事件触发演示</h1>
    
    <div class="demo-section">
        <h2>🎯 事件触发方式</h2>
        <button onclick="triggerByBuilding()">🏦 建筑互动触发</button>
        <button onclick="triggerByTime()">⏰ 时间触发</button>
        <button onclick="triggerByChat()">💬 聊天触发</button>
        <button onclick="triggerByRandom()">🎲 随机触发</button>
        <div id="trigger-result" class="result"></div>
    </div>
    
    <div class="demo-section">
        <h2>🏢 建筑类型事件</h2>
        <button onclick="generateSituation('banking')">🏦 银行事件</button>
        <button onclick="generateSituation('investment')">📈 投资事件</button>
        <button onclick="generateSituation('lifestyle')">🏠 生活事件</button>
        <button onclick="generateSituation('general')">🎯 通用事件</button>
        <div id="situation-result" class="result"></div>
    </div>
    
    <div class="demo-section">
        <h2>🤖 AI决策演示</h2>
        <button onclick="mockAIDecision('INTJ')">🧠 INTJ决策</button>
        <button onclick="mockAIDecision('ESFP')">🎭 ESFP决策</button>
        <button onclick="mockAIDecision('ISTJ')">📋 ISTJ决策</button>
        <button onclick="mockAIDecision('ENTP')">💡 ENTP决策</button>
        <div id="decision-result" class="result"></div>
    </div>

    <script>
        function triggerByBuilding() {
            document.getElementById('trigger-result').innerHTML = `
                <h4>🏦 建筑互动触发</h4>
                <p>✅ 玩家靠近中央银行</p>
                <p>✅ 按空格键互动</p>
                <p>✅ 触发银行相关事件</p>
                <p>📋 事件类型: banking</p>
            `;
        }
        
        function triggerByTime() {
            document.getElementById('trigger-result').innerHTML = `
                <h4>⏰ 时间触发</h4>
                <p>✅ 每回合自动检查</p>
                <p>✅ 根据回合数触发特定事件</p>
                <p>✅ 季度/年度重要事件</p>
                <p>📋 事件类型: seasonal</p>
            `;
        }
        
        function triggerByChat() {
            document.getElementById('trigger-result').innerHTML = `
                <h4>💬 聊天触发</h4>
                <p>✅ 玩家发送回响消息</p>
                <p>✅ AI分析消息内容</p>
                <p>✅ 生成相关情况</p>
                <p>📋 事件类型: interactive</p>
            `;
        }
        
        function triggerByRandom() {
            document.getElementById('trigger-result').innerHTML = `
                <h4>🎲 随机触发</h4>
                <p>✅ 基于概率随机发生</p>
                <p>✅ 考虑角色状态和MBTI</p>
                <p>✅ 增加游戏不确定性</p>
                <p>📋 事件类型: random</p>
            `;
        }
        
        async function generateSituation(contextType) {
            const mockData = {
                name: "测试玩家",
                mbti: "INTP",
                assets: 500000,
                contextType: contextType
            };
            
            try {
                const response = await fetch('/api/generate_situation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(mockData)
                });
                
                const result = await response.json();
                document.getElementById('situation-result').innerHTML = `
                    <h4>📋 ${contextType} 事件</h4>
                    <p><strong>情况:</strong> ${result.situation}</p>
                    <div><strong>选项:</strong></div>
                    <ul>
                        ${result.options.map((option, i) => `<li>${i+1}. ${option}</li>`).join('')}
                    </ul>
                `;
            } catch (error) {
                document.getElementById('situation-result').innerHTML = `
                    <h4>❌ 错误</h4>
                    <p>无法连接到服务器，请先启动: python web/server.py</p>
                `;
            }
        }
        
        function mockAIDecision(mbtiType) {
            const decisions = {
                'INTJ': {
                    choice: "选择长期投资策略",
                    reasoning: "作为INTJ，我更倾向于制定长期规划，这个选择符合我的战略思维。"
                },
                'ESFP': {
                    choice: "选择当下享受的选项",
                    reasoning: "作为ESFP，我更关注当下的感受和体验，这个选择让我感觉更好。"
                },
                'ISTJ': {
                    choice: "选择最稳妥的方案",
                    reasoning: "作为ISTJ，我偏好可靠和传统的方法，这个选择风险最小。"
                },
                'ENTP': {
                    choice: "选择创新的机会",
                    reasoning: "作为ENTP，我喜欢探索新的可能性，这个选择最有挑战性。"
                }
            };
            
            const decision = decisions[mbtiType];
            document.getElementById('decision-result').innerHTML = `
                <h4>🤖 ${mbtiType} AI决策</h4>
                <p><strong>选择:</strong> ${decision.choice}</p>
                <p><strong>AI思考:</strong> ${decision.reasoning}</p>
                <p><strong>信任度变化:</strong> +${Math.floor(Math.random() * 5) + 1}</p>
            `;
        }
    </script>
</body>
</html>