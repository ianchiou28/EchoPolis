# EchoPolis è¡Œä¸ºæ´å¯Ÿå¼•æ“

## æ¦‚è¿°

è¡Œä¸ºæ´å¯Ÿå¼•æ“æ˜¯ EchoPolis çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼ŒåŸºäº AI æ•°å­—å­ªç”ŸæŠ€æœ¯ï¼Œä¸“é—¨é’ˆå¯¹ Z ä¸–ä»£ç”¨æˆ·çš„é‡‘èè¡Œä¸ºè¿›è¡Œåˆ†æå’Œæ´å¯Ÿã€‚

## åŠŸèƒ½æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¡Œä¸ºæ´å¯Ÿå¼•æ“ (BehaviorInsightSystem)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  è¡Œä¸ºè®°å½•    â”‚  â”‚  ç”»åƒåˆ†æ    â”‚  â”‚  AIæ´å¯Ÿ     â”‚          â”‚
â”‚  â”‚  log_action â”‚  â”‚  analyze    â”‚  â”‚  generate   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  é¢„è­¦ç³»ç»Ÿ    â”‚  â”‚  ç¾¤ä½“æ´å¯Ÿ    â”‚  â”‚  åŒé¾„å¯¹æ¯”    â”‚          â”‚
â”‚  â”‚  warnings   â”‚  â”‚  cohort     â”‚  â”‚  peer       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç±»

### 1. BehaviorInsightSystem

ä¸»è¦çš„è¡Œä¸ºåˆ†æç³»ç»Ÿï¼Œè´Ÿè´£è®°å½•ã€åˆ†æç”¨æˆ·è¡Œä¸ºã€‚

```python
from core.systems.behavior_insight_system import BehaviorInsightSystem

behavior_system = BehaviorInsightSystem(db)

# è®°å½•è¡Œä¸º
behavior_system.log_action(
    session_id="xxx",
    action_type="investment",
    action_category="stock_buy",
    action_data={"symbol": "AAPL", "amount": 10000},
    game_month=6,
    market_context={"trend": "bull"}
)

# åˆ†æç”»åƒ
profile = behavior_system.analyze_profile(session_id, current_month)

# ç”ŸæˆAIæ´å¯Ÿ
ai_insight = behavior_system.generate_ai_insight(session_id)
```

### 2. è¡Œä¸ºé¢„è­¦åŠŸèƒ½

é¢„è­¦åŠŸèƒ½é›†æˆåœ¨ `BehaviorInsightSystem` ç±»ä¸­ï¼Œæ£€æµ‹6ç§å¸¸è§çš„é‡‘èè¡Œä¸ºé£é™©ï¼š

| é¢„è­¦ç±»å‹ | è¯´æ˜ | ä¸¥é‡ç¨‹åº¦ |
|---------|------|---------|
| high_risk_streak | è¿ç»­é«˜é£é™©æ“ä½œ | high |
| overtrading | è¿‡åº¦äº¤æ˜“ | medium |
| leverage_abuse | æ æ†è¿‡åº¦ä½¿ç”¨ | high |
| herding_behavior | ç¾Šç¾¤æ•ˆåº”å€¾å‘ | medium |
| overconfidence | è¿‡åº¦è‡ªä¿¡é£é™© | medium |
| low_cash_reserve | ç°é‡‘å‚¨å¤‡ä¸è¶³ | high |

```python
from core.systems.behavior_insight_system import BehaviorInsightSystem

behavior_system = BehaviorInsightSystem(db)

# è·å–é¢„è­¦
warnings = behavior_system.get_warnings(session_id, game_state)

# æˆ–ç›´æ¥è°ƒç”¨å†…éƒ¨æ–¹æ³•
alerts = behavior_system.check_behavior_alerts(session_id, current_month)
```

## æ•°æ®åº“è¡¨ç»“æ„

### behavior_logs
è®°å½•æ¯ä¸€æ¬¡ç”¨æˆ·è¡Œä¸º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|-----|
| id | INTEGER | ä¸»é”® |
| session_id | TEXT | ä¼šè¯ID |
| action_type | TEXT | è¡Œä¸ºç±»å‹ |
| action_category | TEXT | è¡Œä¸ºåˆ†ç±» |
| action_data | TEXT | è¡Œä¸ºè¯¦æƒ…(JSON) |
| risk_score | REAL | é£é™©è¯„åˆ† (0-1) |
| rationality_score | REAL | ç†æ€§è¯„åˆ† (0-1) |
| game_month | INTEGER | æ¸¸æˆæœˆä»½ |
| market_context | TEXT | å¸‚åœºèƒŒæ™¯(JSON) |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### behavior_profiles
ç”¨æˆ·è¡Œä¸ºç”»åƒ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|-----|
| session_id | TEXT | ä¼šè¯ID (ä¸»é”®) |
| risk_preference | TEXT | é£é™©åå¥½ (conservative/moderate/aggressive) |
| decision_style | TEXT | å†³ç­–é£æ ¼ (rational/impulsive/passive/adaptive) |
| loss_aversion | REAL | æŸå¤±åŒæ¶ç¨‹åº¦ |
| overconfidence | REAL | è¿‡åº¦è‡ªä¿¡ç¨‹åº¦ |
| herding_tendency | REAL | ç¾Šç¾¤å€¾å‘ |
| planning_ability | REAL | è§„åˆ’èƒ½åŠ› |
| action_count | INTEGER | æ€»è¡Œä¸ºæ¬¡æ•° |
| avg_risk_score | REAL | å¹³å‡é£é™©è¯„åˆ† |
| avg_rationality | REAL | å¹³å‡ç†æ€§è¯„åˆ† |
| last_updated | TIMESTAMP | æœ€åæ›´æ–°æ—¶é—´ |

### cohort_insights
ç¾¤ä½“æ´å¯Ÿ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|-----|
| id | INTEGER | ä¸»é”® |
| insight_type | TEXT | æ´å¯Ÿç±»å‹ |
| insight_category | TEXT | æ´å¯Ÿåˆ†ç±» |
| title | TEXT | æ ‡é¢˜ |
| description | TEXT | è¯¦ç»†æè¿° |
| data_source | TEXT | æ•°æ®æ¥æº |
| sample_size | INTEGER | æ ·æœ¬é‡ |
| confidence_level | REAL | ç½®ä¿¡åº¦ |
| tags | TEXT | æ ‡ç­¾ |
| generated_month | INTEGER | ç”Ÿæˆæœˆä»½ |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

## API ç«¯ç‚¹

### ä¸ªäººæ´å¯Ÿ
```
GET /insights/personal/{session_id}
```

è¿”å›ç”¨æˆ·çš„è¡Œä¸ºç”»åƒã€è¿‘æœŸè¡Œä¸ºç»Ÿè®¡ã€ä¸ªæ€§åŒ–å»ºè®®ã€‚

### ç¾¤ä½“æ´å¯Ÿ
```
GET /insights/cohort?limit=20
```

è¿”å›Zä¸–ä»£ç¾¤ä½“çš„è¡Œä¸ºæ´å¯Ÿã€‚

### è¡Œä¸ºç»Ÿè®¡
```
GET /insights/statistics/{session_id}
```

è¿”å›é›·è¾¾å›¾æ•°æ®ã€åˆ†ç±»åˆ†å¸ƒã€æœˆåº¦æ´»è·ƒåº¦ã€é£é™©è¶‹åŠ¿ç­‰ã€‚

### AIæ´å¯Ÿ
```
GET /insights/ai/{session_id}
```

è°ƒç”¨DeepSeek AIç”Ÿæˆä¸ªæ€§åŒ–åˆ†ææŠ¥å‘Šã€‚

### è¡Œä¸ºé¢„è­¦
```
GET /insights/warnings/{session_id}
```

è¿”å›å½“å‰æ£€æµ‹åˆ°çš„è¡Œä¸ºé£é™©é¢„è­¦ã€‚

### åŒé¾„äººå¯¹æ¯”
```
GET /insights/peer-comparison/{session_id}
```

è¿”å›ä¸åŒé¾„äººçš„å¤šç»´åº¦å¯¹æ¯”æ•°æ®ã€‚

## è¡Œä¸ºæˆå°±

ç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºæ¨¡å¼è§£é”ç‰¹å®šæˆå°±ï¼š

| æˆå°±ID | åç§° | è§£é”æ¡ä»¶ |
|-------|------|---------|
| BEHAVIOR_RATIONAL | ç†æ€§æŠ•èµ„è€… | å¹³å‡ç†æ€§è¯„åˆ† â‰¥ 80% |
| BEHAVIOR_DIVERSE | å¤šå…ƒé…ç½®å¸ˆ | æŒæœ‰3ç±»ä»¥ä¸Šä¸åŒèµ„äº§ |
| BEHAVIOR_STABLE | ç¨³å¥æ´¾ | é£é™©åå¥½æ³¢åŠ¨ç‡ < 10% |
| BEHAVIOR_PLANNER | è´¢åŠ¡è§„åˆ’å¸ˆ | è§„åˆ’èƒ½åŠ›è¯„åˆ† â‰¥ 70% |
| BEHAVIOR_NO_HERD | ç‹¬ç«‹æ€è€ƒè€… | ç¾Šç¾¤å€¾å‘ < 30% |
| BEHAVIOR_LOW_RISK | é£æ§è¾¾äºº | å¹³å‡é£é™©è¯„åˆ† < 30% |
| BEHAVIOR_CONSISTENT | ä¸€è‡´æ€§å¤§å¸ˆ | å†³ç­–ä¸€è‡´æ€§ â‰¥ 90% |
| BEHAVIOR_IMPROVED | è‡ªæˆ‘æå‡è€… | 3ä¸ªæœˆå†…ç†æ€§è¯„åˆ†æå‡20% |

## é£é™©è¯„åˆ†ç®—æ³•

### é£é™©è¯„åˆ†è®¡ç®—
```python
def calculate_risk_score(action_data, category, market_context):
    base_risk = RISK_WEIGHTS.get(category, 0.5)
    
    # é‡‘é¢è°ƒæ•´
    if amount > threshold:
        base_risk += 0.1 * (amount / threshold - 1)
    
    # æ æ†è°ƒæ•´
    if leverage > 1:
        base_risk += 0.2 * (leverage - 1)
    
    # å¸‚åœºæƒ…ç»ªè°ƒæ•´
    if market_euphoric and category == 'buy':
        base_risk += 0.1  # è¿½æ¶¨é£é™©
    
    return min(1.0, base_risk)
```

### ç†æ€§è¯„åˆ†è®¡ç®—
```python
def calculate_rationality_score(action_data, category, profile):
    base_rationality = 0.5
    
    # åˆ†æ•£æŠ•èµ„åŠ åˆ†
    if portfolio_diverse:
        base_rationality += 0.15
    
    # é£é™©åŒ¹é…åŠ åˆ†
    if risk_matches_profile:
        base_rationality += 0.1
    
    # ç¾Šç¾¤è¡Œä¸ºå‡åˆ†
    if following_trend:
        base_rationality -= 0.1
    
    return max(0.0, min(1.0, base_rationality))
```

## å‰ç«¯å±•ç¤º

è¡Œä¸ºæ´å¯Ÿé¡µé¢ (`/insights`) åŒ…å«5ä¸ªTabï¼š

1. **ä¸ªäººç”»åƒ** - æ˜¾ç¤ºç”¨æˆ·çš„è¡Œä¸ºç‰¹å¾ç”»åƒ
2. **è¡Œä¸ºç»Ÿè®¡** - é›·è¾¾å›¾ã€åˆ†ç±»åˆ†å¸ƒã€è¶‹åŠ¿å›¾ã€è¡Œä¸ºæ¼”å˜æ›²çº¿
3. **AIæ´å¯Ÿ** - AIç”Ÿæˆçš„ä¸ªæ€§åŒ–åˆ†ææŠ¥å‘Š
4. **ç¾¤ä½“æ´å¯Ÿ** - Zä¸–ä»£ç¾¤ä½“è¡Œä¸ºæ´å¯Ÿ + åŒé¾„äººå¯¹æ¯”
5. **é¢„è­¦** - å®æ—¶é£é™©é¢„è­¦

æ—¶é—´çº¿é¡µé¢ (`/timeline`) ä¹Ÿæ•´åˆäº†è¡Œä¸ºæ—¥å¿—ï¼š
- ğŸ§  è¡Œä¸ºæ—¥å¿—ä¸äº‹ä»¶/äº¤æ˜“å¹¶åˆ—å±•ç¤º
- æ˜¾ç¤ºæ¯æ¬¡è¡Œä¸ºçš„é£é™©è¯„åˆ†å’Œç†æ€§è¯„åˆ†
- é¢œè‰²ç¼–ç æ ‡è¯†é£é™©ç­‰çº§

## æ›´æ–°æ—¥å¿—

### Phase 4 (å½“å‰)
- âœ… è¡Œä¸ºæ¼”å˜è¶‹åŠ¿å›¾è¡¨
- âœ… è¡Œä¸ºé‡Œç¨‹ç¢‘æ£€æµ‹
- âœ… è¶‹åŠ¿æ€»ç»“è‡ªåŠ¨ç”Ÿæˆ
- âœ… æ—¶é—´çº¿é›†æˆè¡Œä¸ºæ—¥å¿—
- âœ… æ–°å¢ `/insights/evolution/{session_id}` API
- âœ… æ–°å¢ `/behavior-logs/{session_id}` API

### Phase 3
- âœ… è¡Œä¸ºé¢„è­¦ç³»ç»Ÿ (é›†æˆåˆ° BehaviorInsightSystem)
- âœ… è¡Œä¸ºä¸æˆå°±å…³è”
- âœ… åŒé¾„äººå¯¹æ¯”åŠŸèƒ½

### Phase 2
- âœ… æ‰©å±•è¡Œä¸ºè®°å½•åˆ°6ä¸ªAPI
- âœ… AIæ´å¯Ÿç”Ÿæˆ
- âœ… è¡Œä¸ºç»Ÿè®¡ç«¯ç‚¹
- âœ… å‰ç«¯å¢å¼º

### Phase 1
- âœ… æ•°æ®åº“è¡¨ç»“æ„
- âœ… BehaviorInsightSystemæ ¸å¿ƒç±»
- âœ… åŸºç¡€APIç«¯ç‚¹

## ä½œè€…

FinAI Team - Zä¸–ä»£é‡‘èæ•™è‚²å¹³å°
