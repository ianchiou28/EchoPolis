<template>
  <div class="operation-panel glass-panel">
    <div class="panel-header">
      <div class="header-left">
        <span class="icon">{{ districtIcon }}</span>
        <div>
          <h3>{{ districtName }}</h3>
          <p class="subtitle">{{ districtTagline }}</p>
        </div>
      </div>
      <button class="btn-close" @click="$emit('close')">âœ•</button>
    </div>

    <div class="panel-body">
      <!-- é‡‘èåŒºæ“ä½œ -->
      <div v-if="districtId === 'finance'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('deposit')">
          <div class="card-icon">ğŸ’°</div>
          <h4>å®šæœŸå­˜æ¬¾</h4>
          <p>ç¨³å¥æ”¶ç›Šï¼Œä¿æœ¬ä¿æ¯</p>
          <div class="card-meta">
            <span class="badge success">ä½é£é™©</span>
            <span class="rate">3-5% å¹´åŒ–</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('loan')">
          <div class="card-icon">ğŸ’³</div>
          <h4>é“¶è¡Œè´·æ¬¾</h4>
          <p>è·å–èµ„é‡‘æ”¯æŒ</p>
          <div class="card-meta">
            <span class="badge warning">éœ€å®¡æ ¸</span>
            <span class="rate">6-12% åˆ©ç‡</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('credit_check')">
          <div class="card-icon">ğŸ“Š</div>
          <h4>ä¿¡ç”¨æŸ¥è¯¢</h4>
          <p>æŸ¥çœ‹å½“å‰ä¿¡ç”¨åˆ†</p>
          <div class="card-meta">
            <span class="badge info">å…è´¹</span>
          </div>
        </div>
      </div>

      <!-- äº¤æ˜“æ‰€æ“ä½œ -->
      <div v-if="districtId === 'tech'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('stock_trade')">
          <div class="card-icon">ğŸ“ˆ</div>
          <h4>è‚¡ç¥¨äº¤æ˜“</h4>
          <p>ä¹°å–ä¸Šå¸‚å…¬å¸è‚¡ç¥¨</p>
          <div class="card-meta">
            <span class="badge danger">é«˜é£é™©</span>
            <span class="rate">Â±20% æ³¢åŠ¨</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('fund_invest')">
          <div class="card-icon">ğŸ“Š</div>
          <h4>åŸºé‡‘ç”³è´­</h4>
          <p>ä¸“ä¸šå›¢é˜Ÿç®¡ç†</p>
          <div class="card-meta">
            <span class="badge warning">ä¸­é£é™©</span>
            <span class="rate">8-15% å¹´åŒ–</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('futures')">
          <div class="card-icon">âš¡</div>
          <h4>æœŸè´§åˆçº¦</h4>
          <p>æ æ†äº¤æ˜“ï¼Œé«˜æ”¶ç›Š</p>
          <div class="card-meta">
            <span class="badge danger">æé«˜é£é™©</span>
            <span class="rate">10x æ æ†</span>
          </div>
        </div>
      </div>

      <!-- æˆ¿äº§ä¸­å¿ƒæ“ä½œ -->
      <div v-if="districtId === 'housing'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('buy_house')">
          <div class="card-icon">ğŸ </div>
          <h4>è´­ä¹°æˆ¿äº§</h4>
          <p>é•¿æœŸä¿å€¼å¢å€¼</p>
          <div class="card-meta">
            <span class="badge success">ä¼˜è´¨èµ„äº§</span>
            <span class="rate">5-10% å¹´å¢</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('rent')">
          <div class="card-icon">ğŸ”‘</div>
          <h4>ç§Ÿèµæˆ¿å±‹</h4>
          <p>çµæ´»å±…ä½é€‰æ‹©</p>
          <div class="card-meta">
            <span class="badge info">æœˆä»˜</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('property_manage')">
          <div class="card-icon">ğŸ¢</div>
          <h4>ç‰©ä¸šç®¡ç†</h4>
          <p>æŸ¥çœ‹æŒæœ‰æˆ¿äº§</p>
          <div class="card-meta">
            <span class="badge info">ç®¡ç†</span>
          </div>
        </div>
      </div>

      <!-- æ•™è‚²åŒºæ“ä½œ -->
      <div v-if="districtId === 'learning'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('skill_course')">
          <div class="card-icon">ğŸ“š</div>
          <h4>æŠ€èƒ½åŸ¹è®­</h4>
          <p>æå‡èŒä¸šæŠ€èƒ½</p>
          <div class="card-meta">
            <span class="badge success">é•¿æœŸå—ç›Š</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('finance_course')">
          <div class="card-icon">ğŸ’¡</div>
          <h4>é‡‘èè¯¾ç¨‹</h4>
          <p>å­¦ä¹ æŠ•èµ„çŸ¥è¯†</p>
          <div class="card-meta">
            <span class="badge info">æå‡ç†è´¢èƒ½åŠ›</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('certificate')">
          <div class="card-icon">ğŸ“</div>
          <h4>è€ƒå–è¯ä¹¦</h4>
          <p>è·å¾—ä¸“ä¸šè®¤è¯</p>
          <div class="card-meta">
            <span class="badge warning">éœ€è€ƒè¯•</span>
          </div>
        </div>
      </div>

      <!-- æ–‡å¨±åŒºæ“ä½œ -->
      <div v-if="districtId === 'leisure'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('entertainment')">
          <div class="card-icon">ğŸ¬</div>
          <h4>ä¼‘é—²å¨±ä¹</h4>
          <p>æ”¾æ¾èº«å¿ƒï¼Œæ¢å¤ç²¾åŠ›</p>
          <div class="card-meta">
            <span class="badge success">+ç²¾åŠ›</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('social')">
          <div class="card-icon">ğŸ¤</div>
          <h4>ç¤¾äº¤æ´»åŠ¨</h4>
          <p>æ‹“å±•äººè„‰å…³ç³»</p>
          <div class="card-meta">
            <span class="badge info">+äººè„‰</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('luxury')">
          <div class="card-icon">ğŸ’</div>
          <h4>å¥¢ä¾ˆæ¶ˆè´¹</h4>
          <p>æå‡å¹¸ç¦æ„Ÿ</p>
          <div class="card-meta">
            <span class="badge warning">é«˜æ¶ˆè´¹</span>
          </div>
        </div>
      </div>

      <!-- èƒ½æºåŒºæ“ä½œ -->
      <div v-if="districtId === 'green'" class="operations-grid">
        <div class="operation-card" @click.stop="handleOperation('green_invest')">
          <div class="card-icon">ğŸŒ±</div>
          <h4>ç»¿è‰²æŠ•èµ„</h4>
          <p>ESGå¯æŒç»­é¡¹ç›®</p>
          <div class="card-meta">
            <span class="badge success">ç¯ä¿</span>
            <span class="rate">6-10% å¹´åŒ–</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('energy_stock')">
          <div class="card-icon">âš¡</div>
          <h4>æ–°èƒ½æºè‚¡ç¥¨</h4>
          <p>æŠ•èµ„æ¸…æ´èƒ½æº</p>
          <div class="card-meta">
            <span class="badge warning">ä¸­é«˜é£é™©</span>
          </div>
        </div>
        
        <div class="operation-card" @click.stop="handleOperation('carbon_trade')">
          <div class="card-icon">ğŸŒ</div>
          <h4>ç¢³äº¤æ˜“</h4>
          <p>ç¢³æ’æ”¾æƒäº¤æ˜“</p>
          <div class="card-meta">
            <span class="badge info">æ–°å…´å¸‚åœº</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- æ“ä½œè¯¦æƒ…å¼¹çª— - ä½¿ç”¨Teleportç§»åˆ°bodyç‹¬ç«‹æ˜¾ç¤º -->
  <Teleport to="body">
    <transition name="modal">
      <div v-if="showOperationModal" class="operation-modal-standalone" @click="closeOperationModal">
        <div class="modal-content" @click.stop>
          <div class="modal-header">
            <h3>{{ currentOperation?.title }}</h3>
            <button class="btn-close" @click="closeOperationModal">âœ•</button>
          </div>
          <div class="modal-body">
            <p>{{ currentOperation?.description }}</p>
            
            <div class="input-group" v-if="currentOperation?.needsAmount">
              <label>é‡‘é¢</label>
              <input 
                v-model.number="operationAmount" 
                type="number" 
                placeholder="è¯·è¾“å…¥é‡‘é¢"
                class="input"
              />
            </div>

            <div class="operation-info">
              <div class="info-item">
                <span>é¢„è®¡æˆæœ¬</span>
                <span class="value">Â¥{{ formatNumber(operationAmount || currentOperation?.defaultAmount || 0) }}</span>
              </div>
              <div class="info-item" v-if="currentOperation?.expectedReturn">
                <span>é¢„æœŸæ”¶ç›Š</span>
                <span class="value positive">+{{ currentOperation.expectedReturn }}</span>
              </div>
              <div class="info-item" v-if="currentOperation?.riskLevel">
                <span>é£é™©ç­‰çº§</span>
                <span :class="['badge', currentOperation.riskLevel]">
                  {{ riskLevelText(currentOperation.riskLevel) }}
                </span>
              </div>
            </div>

            <div class="ai-advice" v-if="aiAdvice">
              <div class="advice-header">
                <span class="icon">ğŸ¤–</span>
                <strong>AI å»ºè®®</strong>
              </div>
              <p>{{ aiAdvice }}</p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn ghost" @click="closeOperationModal">å–æ¶ˆ</button>
            <button 
              class="btn primary" 
              @click="confirmOperation"
              :disabled="isExecuting">
              {{ isExecuting ? 'æ‰§è¡Œä¸­...' : 'ç¡®è®¤æ‰§è¡Œ' }}
            </button>
          </div>
        </div>
      </div>
    </transition>
  </Teleport>
</template>

<script setup>
import { ref, computed } from 'vue'
import axios from 'axios'

const props = defineProps({
  districtId: {
    type: String,
    required: true
  },
  districtName: String,
  districtTagline: String,
  districtIcon: String,
  sessionId: String,
  currentCash: Number
})

const emit = defineEmits(['close', 'operation-complete'])

const showOperationModal = ref(false)
const currentOperation = ref(null)
const operationAmount = ref(0)
const aiAdvice = ref('')
const isExecuting = ref(false)

const operationConfigs = {
  // é‡‘èåŒº
  deposit: { 
    title: 'å®šæœŸå­˜æ¬¾', 
    description: 'å­˜å…¥èµ„é‡‘è·å–ç¨³å®šåˆ©æ¯æ”¶ç›Š',
    needsAmount: true,
    defaultAmount: 10000,
    expectedReturn: '3-5% å¹´åŒ–',
    riskLevel: 'success'
  },
  loan: { 
    title: 'é“¶è¡Œè´·æ¬¾', 
    description: 'å‘é“¶è¡Œç”³è¯·è´·æ¬¾ï¼Œéœ€è¦æ”¯ä»˜åˆ©æ¯',
    needsAmount: true,
    defaultAmount: 50000,
    riskLevel: 'warning'
  },
  credit_check: { 
    title: 'ä¿¡ç”¨æŸ¥è¯¢', 
    description: 'æŸ¥çœ‹å½“å‰ä¿¡ç”¨è¯„åˆ†å’Œå€Ÿè´·èƒ½åŠ›',
    needsAmount: false
  },
  
  // äº¤æ˜“æ‰€
  stock_trade: { 
    title: 'è‚¡ç¥¨äº¤æ˜“', 
    description: 'ä¹°å…¥æˆ–å–å‡ºè‚¡ç¥¨ï¼Œè·å–ä»·å·®æ”¶ç›Š',
    needsAmount: true,
    defaultAmount: 20000,
    expectedReturn: 'Â±20%',
    riskLevel: 'danger'
  },
  fund_invest: { 
    title: 'åŸºé‡‘ç”³è´­', 
    description: 'è´­ä¹°åŸºé‡‘ä»½é¢ï¼Œç”±ä¸“ä¸šå›¢é˜Ÿç®¡ç†',
    needsAmount: true,
    defaultAmount: 30000,
    expectedReturn: '8-15% å¹´åŒ–',
    riskLevel: 'warning'
  },
  futures: { 
    title: 'æœŸè´§åˆçº¦', 
    description: 'æ æ†äº¤æ˜“æœŸè´§ï¼Œé«˜é£é™©é«˜æ”¶ç›Š',
    needsAmount: true,
    defaultAmount: 50000,
    expectedReturn: 'Â±100%',
    riskLevel: 'danger'
  },
  
  // æˆ¿äº§ä¸­å¿ƒ
  buy_house: { 
    title: 'è´­ä¹°æˆ¿äº§', 
    description: 'è´­ä¹°ä½å®…æˆ–å•†ä¸šåœ°äº§',
    needsAmount: true,
    defaultAmount: 500000,
    expectedReturn: '5-10% å¹´å¢',
    riskLevel: 'success'
  },
  rent: { 
    title: 'ç§Ÿèµæˆ¿å±‹', 
    description: 'æ”¯ä»˜æœˆç§Ÿï¼Œè·å¾—å±…ä½æƒ',
    needsAmount: true,
    defaultAmount: 3000
  },
  property_manage: { 
    title: 'ç‰©ä¸šç®¡ç†', 
    description: 'æŸ¥çœ‹å’Œç®¡ç†æŒæœ‰çš„æˆ¿äº§',
    needsAmount: false
  },
  
  // æ•™è‚²åŒº
  skill_course: { 
    title: 'æŠ€èƒ½åŸ¹è®­', 
    description: 'å­¦ä¹ æ–°æŠ€èƒ½æå‡èŒä¸šèƒ½åŠ›',
    needsAmount: true,
    defaultAmount: 5000,
    expectedReturn: 'æå‡æ”¶å…¥æ½œåŠ›'
  },
  finance_course: { 
    title: 'é‡‘èè¯¾ç¨‹', 
    description: 'å­¦ä¹ æŠ•èµ„ç†è´¢çŸ¥è¯†',
    needsAmount: true,
    defaultAmount: 3000,
    expectedReturn: 'æå‡æŠ•èµ„èƒ½åŠ›'
  },
  certificate: { 
    title: 'è€ƒå–è¯ä¹¦', 
    description: 'è·å¾—ä¸“ä¸šèµ„æ ¼è®¤è¯',
    needsAmount: true,
    defaultAmount: 8000
  },
  
  // æ–‡å¨±åŒº
  entertainment: { 
    title: 'ä¼‘é—²å¨±ä¹', 
    description: 'çœ‹ç”µå½±ã€æ—…æ¸¸ç­‰æ”¾æ¾æ´»åŠ¨',
    needsAmount: true,
    defaultAmount: 2000,
    expectedReturn: '+10 ç²¾åŠ›'
  },
  social: { 
    title: 'ç¤¾äº¤æ´»åŠ¨', 
    description: 'å‚åŠ èšä¼šï¼Œæ‹“å±•äººè„‰',
    needsAmount: true,
    defaultAmount: 1500,
    expectedReturn: '+5 äººè„‰å€¼'
  },
  luxury: { 
    title: 'å¥¢ä¾ˆæ¶ˆè´¹', 
    description: 'è´­ä¹°å¥¢ä¾ˆå“æå‡å¹¸ç¦æ„Ÿ',
    needsAmount: true,
    defaultAmount: 10000,
    expectedReturn: '+20 å¹¸ç¦æ„Ÿ'
  },
  
  // èƒ½æºåŒº
  green_invest: { 
    title: 'ç»¿è‰²æŠ•èµ„', 
    description: 'æŠ•èµ„ç¯ä¿å¯æŒç»­é¡¹ç›®',
    needsAmount: true,
    defaultAmount: 40000,
    expectedReturn: '6-10% å¹´åŒ–',
    riskLevel: 'success'
  },
  energy_stock: { 
    title: 'æ–°èƒ½æºè‚¡ç¥¨', 
    description: 'æŠ•èµ„æ¸…æ´èƒ½æºå…¬å¸è‚¡ç¥¨',
    needsAmount: true,
    defaultAmount: 25000,
    expectedReturn: '10-20%',
    riskLevel: 'warning'
  },
  carbon_trade: { 
    title: 'ç¢³äº¤æ˜“', 
    description: 'å‚ä¸ç¢³æ’æ”¾æƒäº¤æ˜“',
    needsAmount: true,
    defaultAmount: 15000,
    riskLevel: 'info'
  }
}

const handleOperation = (operationType) => {
  console.log('handleOperation called:', operationType)
  currentOperation.value = {
    type: operationType,
    ...operationConfigs[operationType]
  }
  operationAmount.value = currentOperation.value.defaultAmount || 0
  showOperationModal.value = true
  console.log('showOperationModal set to:', showOperationModal.value)
  
  // è·å–AIå»ºè®®
  fetchAIAdvice(operationType)
}

const fetchAIAdvice = async (operationType) => {
  aiAdvice.value = 'æ­£åœ¨è·å–AIå»ºè®®...'
  
  // æ¨¡æ‹ŸAIå»ºè®®
  setTimeout(() => {
    const advices = {
      deposit: 'æ ¹æ®å½“å‰å¸‚åœºåˆ©ç‡ï¼Œå»ºè®®å­˜å…¥ä¸­é•¿æœŸå®šæœŸä»¥è·å–æ›´é«˜æ”¶ç›Š',
      loan: 'æ‚¨çš„ä¿¡ç”¨è‰¯å¥½ï¼Œå¯ä»¥ç”³è¯·è´·æ¬¾ã€‚å»ºè®®ç”¨äºæŠ•èµ„è€Œéæ¶ˆè´¹',
      stock_trade: 'å½“å‰å¸‚åœºæ³¢åŠ¨è¾ƒå¤§ï¼Œå»ºè®®è°¨æ…æ“ä½œï¼Œè®¾ç½®æ­¢æŸçº¿',
      buy_house: 'è¯¥åŒºåŸŸæˆ¿ä»·å¤„äºåˆç†åŒºé—´ï¼Œé€‚åˆé•¿æœŸæŒæœ‰',
      skill_course: 'æŠ•èµ„æ•™è‚²æ˜¯æœ€ç¨³å®šçš„æŠ•èµ„ï¼Œå»ºè®®é€‰æ‹©å¸‚åœºéœ€æ±‚å¤§çš„æŠ€èƒ½'
    }
    aiAdvice.value = advices[operationType] || 'è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œç¬¦åˆæ‚¨å½“å‰çš„è´¢åŠ¡çŠ¶å†µ'
  }, 800)
}

const confirmOperation = async () => {
  if (currentOperation.value.needsAmount && (!operationAmount.value || operationAmount.value <= 0)) {
    alert('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢')
    return
  }

  if (currentOperation.value.needsAmount && operationAmount.value > props.currentCash) {
    alert('ç°é‡‘ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ')
    return
  }

  isExecuting.value = true

  try {
    const response = await axios.post('/api/world/action', {
      session_id: props.sessionId,
      action_name: currentOperation.value.title,
      action: currentOperation.value.type,
      price: operationAmount.value || 0,
      building: props.districtId
    })

    if (response.data.success) {
      alert(`æ“ä½œæˆåŠŸï¼\n${response.data.message}\n${response.data.ai_comment || ''}`)
      emit('operation-complete', response.data)
      closeOperationModal()
      emit('close')
    } else {
      alert(`æ“ä½œå¤±è´¥ï¼š${response.data.message}\n${response.data.ai_advice || ''}`)
    }
  } catch (error) {
    console.error('æ“ä½œæ‰§è¡Œå¤±è´¥:', error)
    alert('æ“ä½œå¤±è´¥ï¼š' + (error.response?.data?.detail || error.message))
  } finally {
    isExecuting.value = false
  }
}

const closeOperationModal = () => {
  showOperationModal.value = false
  currentOperation.value = null
  operationAmount.value = 0
  aiAdvice.value = ''
}

const formatNumber = (num) => {
  return Number(num || 0).toLocaleString('zh-CN')
}

const riskLevelText = (level) => {
  const map = {
    success: 'ä½é£é™©',
    info: 'æä½é£é™©',
    warning: 'ä¸­ç­‰é£é™©',
    danger: 'é«˜é£é™©'
  }
  return map[level] || 'æœªçŸ¥'
}
</script>

<style scoped>
.operation-panel {
  background: rgba(10,14,39,0.85);
  backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(59,130,246,0.4);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(2,6,23,0.9);
  position: relative;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid rgba(59,130,246,0.2);
  background: rgba(59,130,246,0.1);
}

.header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.header-left .icon {
  font-size: 40px;
}

.header-left h3 {
  margin: 0 0 4px 0;
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
}

.subtitle {
  margin: 0;
  font-size: 13px;
  color: rgba(255,255,255,0.6);
}

.btn-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 1px solid rgba(148,163,184,0.3);
  background: rgba(15,23,42,0.8);
  color: var(--text);
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-close:hover {
  background: rgba(239,68,68,0.3);
  border-color: #ef4444;
  transform: rotate(90deg);
}

.panel-body {
  padding: 24px;
  max-height: calc(80vh - 100px);
  overflow-y: auto;
}

.operations-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}

@media (max-width: 768px) {
  .operations-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .operations-grid {
    grid-template-columns: 1fr;
  }
}

.operation-card {
  padding: 20px;
  border-radius: 14px;
  background: rgba(15,23,42,0.7);
  border: 1px solid rgba(148,163,184,0.3);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.operation-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(59,130,246,0.3), transparent 70%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.operation-card:hover {
  border-color: rgba(59,130,246,0.6);
  background: rgba(59,130,246,0.15);
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(59,130,246,0.4);
}

.operation-card:hover::before {
  opacity: 1;
}

.card-icon {
  font-size: 36px;
  margin-bottom: 12px;
}

.operation-card h4 {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
}

.operation-card p {
  margin: 0 0 12px 0;
  font-size: 13px;
  color: rgba(255,255,255,0.7);
  line-height: 1.5;
}

.card-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.badge {
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
}

.badge.success {
  background: rgba(34,197,94,0.2);
  color: #22c55e;
}

.badge.info {
  background: rgba(59,130,246,0.2);
  color: #3b82f6;
}

.badge.warning {
  background: rgba(251,191,36,0.2);
  color: #fbbf24;
}

.badge.danger {
  background: rgba(239,68,68,0.2);
  color: #ef4444;
}

.rate {
  font-size: 12px;
  color: rgba(255,255,255,0.6);
}

/* æ“ä½œå¼¹çª— - ç‹¬ç«‹å¼¹çª—é€šè¿‡Teleportæ¸²æŸ“åˆ°body */
.operation-modal-standalone {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 99999;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(10px);
  padding: 20px;
  overflow-y: auto;
}

.modal-content {
  width: min(500px, 90vw);
  max-height: 90vh;
  background: rgba(10,14,39,0.95);
  border: 1px solid rgba(59,130,246,0.4);
  border-radius: 20px;
  box-shadow: 0 25px 70px rgba(0,0,0,0.8);
  display: flex;
  flex-direction: column;
  margin: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid rgba(59,130,246,0.2);
  background: rgba(59,130,246,0.1);
}

.modal-header h3 {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
}

.modal-body {
  padding: 24px;
  overflow-y: auto;
  flex: 1;
}

.modal-body > p {
  margin: 0 0 20px 0;
  color: rgba(255,255,255,0.8);
  line-height: 1.6;
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
}

.input {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  background: rgba(15,23,42,0.8);
  border: 1px solid rgba(148,163,184,0.3);
  color: var(--text);
  font-size: 16px;
  font-family: inherit;
}

.input:focus {
  outline: none;
  border-color: rgb(59,130,246);
  box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
}

.operation-info {
  padding: 16px;
  border-radius: 12px;
  background: rgba(15,23,42,0.6);
  border: 1px solid rgba(148,163,184,0.2);
  margin-bottom: 20px;
}

.info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  font-size: 14px;
}

.info-item:not(:last-child) {
  border-bottom: 1px solid rgba(148,163,184,0.1);
}

.info-item .value {
  font-weight: 600;
}

.info-item .value.positive {
  color: #10b981;
}

.ai-advice {
  padding: 16px;
  border-radius: 12px;
  background: rgba(99,102,241,0.15);
  border: 1px solid rgba(99,102,241,0.4);
}

.advice-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-weight: 600;
  color: rgb(167,139,250);
}

.ai-advice p {
  margin: 0;
  font-size: 13px;
  color: rgba(255,255,255,0.85);
  line-height: 1.6;
}

.modal-footer {
  display: flex;
  gap: 12px;
  padding: 20px 24px;
  border-top: 1px solid rgba(59,130,246,0.2);
  background: rgba(15,23,42,0.5);
}

.btn {
  flex: 1;
  padding: 12px 24px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.btn.primary {
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  color: white;
  border: none;
}

.btn.primary:hover:not(:disabled) {
  box-shadow: 0 0 20px rgba(59,130,246,0.6);
  transform: translateY(-2px);
}

.btn.primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn.ghost {
  background: rgba(15,23,42,0.8);
  border: 1px solid rgba(148,163,184,0.3);
  color: var(--text);
}

.btn.ghost:hover {
  background: rgba(148,163,184,0.2);
  border-color: rgba(148,163,184,0.5);
}

/* åŠ¨ç”» */
.modal-enter-active,
.modal-leave-active {
  transition: opacity 0.3s ease;
}

.modal-enter-active .modal-content,
.modal-leave-active .modal-content {
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-enter-from,
.modal-leave-to {
  opacity: 0;
}

.modal-enter-from .modal-content {
  transform: scale(0.9) translateY(20px);
}

.modal-leave-to .modal-content {
  transform: scale(0.9) translateY(20px);
}
</style>
